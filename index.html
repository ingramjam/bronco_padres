<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bronco Padres Manager</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <style>
        :root {
            /* PADRES THEME */
            --primary: #2F241D; /* Padres Brown */
            --secondary: #FFC425; /* Padres Gold */
            --bg: #f8f8f8;
            --card-bg: #ffffff;
            --text: #2F241D;
            --warning: #d32f2f;
            --gc-blue: #0086d1;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; padding-bottom: 80px; }
        .container { max-width: 800px; margin: 0 auto; padding: 15px; }
        
        /* HEADER IMAGE */
        .header-img {
            width: 100%;
            height: auto;
            display: block;
            margin-bottom: 15px;
            border-bottom: 4px solid var(--secondary);
        }

        /* NAV TABS */
        .nav-tabs { display: flex; background: var(--primary); padding: 5px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.2); margin-bottom: 20px; position: sticky; top: 10px; z-index: 100; gap: 5px; }
        .tab-btn { flex: 1; border: none; background: transparent; padding: 12px 2px; font-size: 0.75rem; font-weight: bold; color: #ccc; border-radius: 8px; cursor: pointer; transition: 0.2s; white-space: nowrap; text-transform: uppercase; text-align: center; }
        .tab-btn.active { background: var(--secondary); color: var(--primary); box-shadow: 0 2px 4px rgba(0,0,0,0.3); }

        .view-section { display: none; }
        .view-section.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* LINEUP CARD */
        .lineup-list { list-style: none; padding: 0; margin: 0; }
        .lineup-item { background: white; padding: 12px; margin-bottom: 8px; border-radius: 8px; display: flex; align-items: center; justify-content: space-between; border-left: 6px solid var(--primary); box-shadow: 0 1px 3px rgba(0,0,0,0.1); touch-action: none; /* Prevents scroll while dragging */ }
        .player-order { font-weight: bold; color: var(--secondary); background: var(--primary); width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; margin-right: 10px; flex-shrink: 0; }
        .player-info { flex: 1; pointer-events: none; /* Allows drag on text area */ }
        .player-name { font-weight: bold; color: var(--primary); font-size: 1rem; display: block; }
        .player-num { font-size: 0.8rem; color: #888; }
        .pos-select { padding: 8px; border-radius: 6px; border: 1px solid #ccc; background: #f0f0f0; font-weight: bold; color: #333; font-size: 1rem; margin-right: 10px; }
        .drag-handle { color: #ccc; font-size: 1.5rem; padding: 0 10px; cursor: grab; }
        
        .reset-btn { margin-top: 20px; background: white; border: 1px solid #ccc; color: #333; padding: 12px 25px; border-radius: 20px; font-size: 0.9rem; cursor: pointer; display: block; margin-left: auto; margin-right: auto; }

        /* BINGO STYLES */
        .bingo-wrapper { display: flex; flex-direction: column; align-items: center; }
        .bingo-card { display: grid; grid-template-columns: repeat(5, 1fr); gap: 4px; width: 100%; max-width: 400px; background-color: #333; border: 2px solid #333; padding: 5px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); margin-top: 10px; }
        .bingo-square { background-color: #fff; padding: 5px; text-align: center; font-size: 0.6rem; cursor: pointer; user-select: none; display: flex; align-items: center; justify-content: center; height: 60px; word-break: break-word; line-height: 1.1; font-weight: 500; border: 1px solid #ddd; }
        .bingo-square.checked { background-color: #c0d9af; text-decoration: line-through; color: #777; opacity: 0.8; }
        .center-square { background-image: url("https://dt5602vnjxv0c.cloudfront.net/portals/28785/logo638424003336325100.png"); background-size: contain; background-repeat: no-repeat; background-position: center; pointer-events: none; }
        .venmo-link { margin-top: 15px; text-align: center; font-weight: bold; }
        .venmo-link a { color: #007bff; text-decoration: none; }

        /* SHARED & OTHER VIEWS */
        .dashboard { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 25px; }
        .stat-card { background: var(--primary); color: white; padding: 15px; border-radius: 8px; text-align: center; border-bottom: 4px solid var(--secondary); }
        .stat-card h3 { margin: 0 0 5px 0; font-size: 0.8rem; opacity: 0.8; text-transform: uppercase; color: var(--secondary); }
        .stat-card .value { font-size: 1.3rem; font-weight: bold; }
        .stat-card.alert { background: var(--warning); border-bottom-color: #b71c1c; }
        .rule-card { background: var(--card-bg); padding: 15px; border-radius: 12px; border-left: 5px solid var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 15px; }
        .rule-card.important { border-left-color: var(--warning); }
        .rule-card h2 { margin-top: 0; font-size: 1rem; color: var(--primary); display: flex; justify-content: space-between; }
        .rule-card .category-tag { font-size: 0.65rem; background: #eee; padding: 2px 6px; border-radius: 4px; color: #666; font-weight: normal; }
        .filters { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 15px; }
        .filter-btn { background: #e0e0e0; border: none; padding: 8px 14px; border-radius: 20px; white-space: nowrap; cursor: pointer; font-size: 0.85rem; }
        .filter-btn.active { background: var(--primary); color: var(--secondary); }
        .search-container input { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ccc; font-size: 16px; box-sizing: border-box; margin-bottom: 15px; }

        /* PITCH COUNTER */
        .counter-card { background: white; border-radius: 15px; padding: 20px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border: 2px solid var(--primary); }
        .pitch-display { font-size: 5rem; font-weight: bold; color: var(--primary); line-height: 1; margin: 10px 0; }
        .rest-status { margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 10px; border: 1px solid #eee; }
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .ctrl-btn { border: none; padding: 15px; border-radius: 12px; font-size: 1.5rem; cursor: pointer; }
        .btn-minus { background: #e0e0e0; color: #333; }
        .btn-plus { background: var(--primary); color: var(--secondary); font-weight: bold; }
    </style>
</head>
<body>

<img src="https://www.escondidoyouthbaseball.com/portals/28785/teamhome/teamhome639045248653715983.png" alt="Padres Header" class="header-img">

<div class="container">
    
    <div class="nav-tabs">
        <button class="tab-btn active" onclick="switchTab('lineup')">ðŸ“‹ Lineup</button>
        <button class="tab-btn" onclick="switchTab('bingo')">ðŸŽ° Bingo</button>
        <button class="tab-btn" onclick="switchTab('rules')">ðŸ“– Rules</button>
        <button class="tab-btn" onclick="switchTab('counter')">âš¾ Pitch</button>
        <button class="tab-btn" onclick="switchTab('schedule')">ðŸ“… Sched</button>
    </div>

    <div id="view-lineup" class="view-section active">
        <div style="background: #fff; padding: 10px; border-radius: 8px; margin-bottom: 10px; text-align: center; font-size: 0.8rem; color: #666;">
            <strong>Drag & Drop</strong> to reorder. Positions save automatically.
        </div>
        <ul class="lineup-list" id="lineupContainer"></ul>
        <button class="reset-btn" onclick="resetLineup()">Reset Order & Positions</button>
    </div>

    <div id="view-bingo" class="view-section">
        <div class="bingo-wrapper">
            <h2 style="color: var(--primary); margin:0;">Game Time Bingo!</h2>
            <div class="bingo-card" id="bingoCard"></div>
            <button class="reset-btn" id="bingoResetBtn" style="margin-top: 15px;">New Card</button>
            <div class="venmo-link"><a href="https://venmo.com/jwyld" target="_blank">Donate</a></div>
        </div>
    </div>

    <div id="view-rules" class="view-section">
        <div class="dashboard">
            <div class="stat-card alert"><h3>Max Pitches</h3><div class="value">85</div></div>
            <div class="stat-card"><h3>Max Time</h3><div class="value">1:50</div></div>
            <div class="stat-card"><h3>Mercy Rule</h3><div class="value">10 run</div></div>
            <div class="stat-card"><h3>Min Play</h3><div class="value">Sit 1/All 1</div></div>
        </div>
        <div class="search-container"><input type="text" id="searchInput" placeholder="Search rules..."></div>
        <div class="filters" id="filterContainer">
            <button class="filter-btn active" onclick="filterRules('All')">All</button>
            <button class="filter-btn" onclick="filterRules('Pitching')">Pitching</button>
            <button class="filter-btn" onclick="filterRules('Game Time')">Time</button>
            <button class="filter-btn" onclick="filterRules('Roster & Batting')">Roster</button>
        </div>
        <div id="rulesContainer"></div>
    </div>

    <div id="view-counter" class="view-section">
        <div class="counter-card">
            <div style="color: #666; font-size: 0.9rem; text-transform: uppercase;">Current Count</div>
            <div class="pitch-display" id="countDisplay">0</div>
            <div class="rest-status">
                <span style="font-size: 1.5rem; font-weight: bold; color: var(--primary); display: block;" id="restDisplay">0 Days Rest</span>
                <span style="font-size: 0.9rem; color: #666;" id="thresholdDisplay">20 pitches until 1 Day Rest</span>
            </div>
            <div class="controls">
                <button class="ctrl-btn btn-minus" onclick="updatePitch(-1)">âˆ’</button>
                <button class="ctrl-btn btn-plus" onclick="updatePitch(1)">+ Pitch</button>
            </div>
            <button class="reset-btn" onclick="if(confirm('Reset counter?')) { updatePitch(-999); }">Reset Counter</button>
        </div>
    </div>

    <div id="view-schedule" class="view-section">
        <div class="rule-card" style="text-align: center; border-left: none;">
            <h2 style="justify-content: center; margin-bottom: 10px;">GameChanger</h2>
            <a href="https://web.gc.com/teams/oygknL58ynlG?utm_source=Web&utm_campaign=team_share_link" target="_blank" style="background: var(--gc-blue); color: white; text-decoration: none; padding: 12px 25px; border-radius: 20px; font-weight: bold; display: inline-block;">Open Schedule</a>
        </div>
        <h3 style="margin-left: 10px; color: var(--primary);">Upcoming (Manual)</h3>
        <ul style="list-style: none; padding: 0;" id="manualGamesList"></ul>
    </div>
</div>

<script>
    /* =========================================
       1. DATA DEFINITIONS (EMBEDDED)
       ========================================= */
    const teamRoster = [
        { name: "Jace Ingram", number: "#3" },
        { name: "Jaxson Fonseca", number: "#29" },
        { name: "JD Mayberry", number: "#51" },
        { name: "Adam Enriquez", number: "" },
        { name: "Blake Taylor", number: "" },
        { name: "Brooks Schott", number: "" },
        { name: "Declan Riley", number: "" },
        { name: "Donovan Cox", number: "" },
        { name: "Giovani Preciado", number: "" },
        { name: "Landon Hodgson", number: "" },
        { name: "Myles Gonzalez", number: "" },
        { name: "Thomas Cabral", number: "" }
    ];

    const broncoRules = [
        { category: "Pitching", title: "Daily Max Pitches", content: "Max 85 pitches/day. Finish batter if limit reached.", important: true },
        { category: "Pitching", title: "Rest Days (11-12)", content: "1-20: 0 Days | 21-35: 1 Day | 36-50: 2 Days | 51-65: 3 Days | 66+: 4 Days.", important: true },
        { category: "Pitching", title: "Pitcher Removal", content: "Once removed, cannot return to pitch. Remove immediately if hitting 3 batters.", important: true },
        { category: "Game Time", title: "Duration", content: "7 innings. No new inning after 1 hr 50 mins. Hard stop 9:45 PM.", important: true },
        { category: "Game Time", title: "Mercy Rule", content: "10 run lead after 5 complete innings (4 Â½ if Home leads).", important: true },
        { category: "Roster & Batting", title: "Batting", content: "Continuous batting order. Everyone bats.", important: false },
        { category: "Roster & Batting", title: "Min Play", content: "No player sits 2 innings until all have sat 1. Must play 1 inning infield (Rec only).", important: true },
        { category: "Base Running", title: "Slide/Avoid", content: "Must slide or avoid contact. Malicious contact = ejection & out.", important: true }
    ];

    const manualGames = [
        { date: "SAT<br>FEB 24", opponent: "vs. Dodgers", info: "10:00 AM â€¢ Field 3 (Home)" },
        { date: "TUE<br>FEB 27", opponent: "@ Angels", info: "5:30 PM â€¢ Field 1 (Visitor)" }
    ];

    /* =========================================
       2. APP LOGIC
       ========================================= */
    let currentRosterOrder = [];
    
    // Init App
    window.onload = function() {
        initLineup();
        renderRules(broncoRules);
        renderGames(manualGames);
        initBingo();
        
        // Init Sortable (Drag & Drop)
        new Sortable(document.getElementById('lineupContainer'), {
            handle: '.lineup-item', 
            animation: 150,
            onEnd: function (evt) {
                const movedItem = currentRosterOrder.splice(evt.oldIndex, 1)[0];
                currentRosterOrder.splice(evt.newIndex, 0, movedItem);
                saveLineup();
                renderLineup(); // Re-render to update numbers
            }
        });
    };

    // --- LINEUP LOGIC ---
    function initLineup() {
        // CHANGED KEY TO v3 TO FORCE RELOAD OF DATA
        const saved = localStorage.getItem('broncoLineup_v3');
        if (saved) {
            currentRosterOrder = JSON.parse(saved);
        } else {
            currentRosterOrder = teamRoster.map(p => ({...p, pos: ""}));
        }
        renderLineup();
    }

    function renderLineup() {
        const container = document.getElementById('lineupContainer');
        container.innerHTML = currentRosterOrder.map((player, index) => `
            <li class="lineup-item">
                <div style="display:flex; align-items:center;">
                    <div class="player-order">${index + 1}</div>
                    <div class="player-info">
                        <span class="player-name">${player.name}</span>
                        <span class="player-num">${player.number}</span>
                    </div>
                </div>
                <div style="display:flex; align-items:center; gap: 5px;">
                    <select class="pos-select" onchange="updatePos(${index}, this.value)">
                        <option value="" ${player.pos===""?'selected':''}>-</option>
                        <option value="P" ${player.pos==="P"?'selected':''}>P</option>
                        <option value="C" ${player.pos==="C"?'selected':''}>C</option>
                        <option value="1B" ${player.pos==="1B"?'selected':''}>1B</option>
                        <option value="2B" ${player.pos==="2B"?'selected':''}>2B</option>
                        <option value="3B" ${player.pos==="3B"?'selected':''}>3B</option>
                        <option value="SS" ${player.pos==="SS"?'selected':''}>SS</option>
                        <option value="LF" ${player.pos==="LF"?'selected':''}>LF</option>
                        <option value="CF" ${player.pos==="CF"?'selected':''}>CF</option>
                        <option value="RF" ${player.pos==="RF"?'selected':''}>RF</option>
                        <option value="BN" ${player.pos==="BN"?'selected':''}>BN</option>
                    </select>
                    <div class="drag-handle">â‰¡</div>
                </div>
            </li>
        `).join('');
    }

    function updatePos(index, value) {
        currentRosterOrder[index].pos = value;
        saveLineup();
    }

    function saveLineup() {
        localStorage.setItem('broncoLineup_v3', JSON.stringify(currentRosterOrder));
    }

    function resetLineup() {
        if(confirm("Reset lineup order and clear positions?")) {
            currentRosterOrder = teamRoster.map(p => ({...p, pos: ""}));
            saveLineup();
            renderLineup();
        }
    }

    // --- BINGO LOGIC ---
    const baseballTerms = [
        "Home Run", "My Kid Strikes Out", "Walk-In Run", "Out", "Foul Ball Out",
        "Double", "Triple", "Grand Slam", "Walk", "Pitcher Cries",
        "Catcher Cries", "Gopher Hole", "My Kid Scored", "Pick Off", "Steal",
        "Error", "RBI", "Dad Kicked Out", "Terrible Call", "Tie Shoes",
        "Hit By Pitch", "No Glove On", "Oven Mitt", "No Game Balls", "Wild Pitch"
    ];
    
    function initBingo() {
        const savedTerms = localStorage.getItem('bingoTerms');
        if (savedTerms) {
            createBingoCard(JSON.parse(savedTerms));
        } else {
            newBingoCard();
        }
        document.getElementById('bingoResetBtn').addEventListener('click', newBingoCard);
    }

    function createBingoCard(terms) {
        const bingoCard = document.getElementById('bingoCard');
        bingoCard.innerHTML = '';
        let squareIndex = 0;
        for (let row = 0; row < 5; row++) {
            for (let col = 0; col < 5; col++) {
                const square = document.createElement('div');
                square.classList.add('bingo-square');
                if (row === 2 && col === 2) {
                    square.classList.add('center-square');
                } else {
                    square.textContent = terms[squareIndex];
                    squareIndex++;
                    square.addEventListener('click', () => square.classList.toggle('checked'));
                }
                bingoCard.appendChild(square);
            }
        }
    }

    function newBingoCard() {
        let array = [...baseballTerms];
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        const currentTerms = array.slice(0, 24);
        localStorage.setItem('bingoTerms', JSON.stringify(currentTerms));
        createBingoCard(currentTerms);
    }

    // --- RULES & SCHEDULE LOGIC ---
    function renderRules(rules) {
        document.getElementById('rulesContainer').innerHTML = rules.map(rule => `
            <div class="rule-card ${rule.important ? 'important' : ''}">
                <h2>${rule.title} <span class="category-tag">${rule.category}</span></h2>
                <p>${rule.content}</p>
            </div>
        `).join('');
    }

    function filterRules(category) {
        document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.toggle('active', btn.innerText === category));
        const query = document.getElementById('searchInput').value.toLowerCase();
        const filtered = broncoRules.filter(rule => {
            const matchesCategory = category === 'All' || rule.category === category || (category === 'Time' && rule.category === 'Game Time');
            const matchesSearch = rule.title.toLowerCase().includes(query) || rule.content.toLowerCase().includes(query);
            return matchesCategory && matchesSearch;
        });
        renderRules(filtered);
    }
    document.getElementById('searchInput').addEventListener('input', () => filterRules('All'));

    function renderGames(games) {
        document.getElementById('manualGamesList').innerHTML = games.map(game => `
            <li class="lineup-item" style="border-left: 4px solid var(--secondary);">
                <div style="font-weight:bold; color:var(--primary); text-align:center; width:50px; line-height:1.2;">${game.date}</div>
                <div style="margin-left:15px;">
                    <div style="font-weight:bold; font-size:1.1rem;">${game.opponent}</div>
                    <div style="color:#666; font-size:0.85rem;">${game.info}</div>
                </div>
            </li>
        `).join('');
    }

    // --- PITCH COUNTER LOGIC ---
    let pitchCount = 0;
    const pitchThresholds = [
        { limit: 20, rest: "0 Days", next: "1 Day" },
        { limit: 35, rest: "1 Day", next: "2 Days" },
        { limit: 50, rest: "2 Days", next: "3 Days" },
        { limit: 65, rest: "3 Days", next: "4 Days" },
        { limit: 85, rest: "4 Days", next: "MAX" }
    ];
    function updatePitch(change) {
        if (change === -999) pitchCount = 0; else pitchCount += change;
        if (pitchCount < 0) pitchCount = 0;
        document.getElementById('countDisplay').innerText = pitchCount;
        let status = pitchThresholds[0];
        let next = pitchThresholds[0].limit;
        if (pitchCount > 65) { status = pitchThresholds[4]; next = 85; }
        else if (pitchCount > 50) { status = pitchThresholds[3]; next = 65; }
        else if (pitchCount > 35) { status = pitchThresholds[2]; next = 50; }
        else if (pitchCount > 20) { status = pitchThresholds[1]; next = 35; }

        if (pitchCount >= 85) {
            document.getElementById('restDisplay').innerText = "MAX LIMIT";
            document.getElementById('thresholdDisplay').innerText = "Finish batter only";
        } else {
            document.getElementById('restDisplay').innerText = status.rest + " Rest";
            document.getElementById('thresholdDisplay').innerText = `${next - pitchCount} until ${status.next} Rest`;
        }
    }

    // --- TAB LOGIC ---
    function switchTab(tabId) {
        document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById('view-' + tabId).classList.add('active');
        const tabMap = { 'lineup': 0, 'bingo': 1, 'rules': 2, 'counter': 3, 'schedule': 4 };
        if(document.querySelectorAll('.tab-btn')[tabMap[tabId]]) {
            document.querySelectorAll('.tab-btn')[tabMap[tabId]].classList.add('active');
        }
    }
</script>
</body>
</html>
