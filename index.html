<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EYB Bronco Manager</title>
    <style>
        :root {
            --primary: #004d40;
            --accent: #d32f2f;
            --warning: #fbc02d;
            --safe: #388e3c;
            --bg: #f4f4f9;
            --card-bg: #ffffff;
            --text: #333;
            --gc-blue: #0086d1;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; padding-bottom: 80px; }
        .header { text-align: center; margin-bottom: 20px; }
        .header h1 { margin: 0; color: var(--primary); font-size: 1.8rem; }
        .header p { margin: 5px 0 0 0; color: #666; font-size: 0.9rem; }
        .nav-tabs { display: flex; background: white; padding: 10px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 20px; position: sticky; top: 10px; z-index: 100; gap: 5px; }
        .tab-btn { flex: 1; border: none; background: transparent; padding: 12px 5px; font-size: 0.9rem; font-weight: bold; color: #888; border-radius: 8px; cursor: pointer; transition: 0.2s; white-space: nowrap; }
        .tab-btn.active { background: var(--primary); color: white; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .view-section { display: none; }
        .view-section.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .search-container { margin-bottom: 15px; }
        input[type="text"] { width: 100%; padding: 15px; border-radius: 8px; border: 1px solid #ccc; font-size: 16px; box-sizing: border-box; }
        .dashboard { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 25px; }
        .stat-card { background: var(--primary); color: white; padding: 15px; border-radius: 8px; text-align: center; }
        .stat-card h3 { margin: 0 0 5px 0; font-size: 0.8rem; opacity: 0.9; text-transform: uppercase; letter-spacing: 0.5px; }
        .stat-card .value { font-size: 1.3rem; font-weight: bold; }
        .stat-card.alert { background: var(--accent); }
        .filters { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 15px; -webkit-overflow-scrolling: touch; }
        .filter-btn { background: #e0e0e0; border: none; padding: 8px 14px; border-radius: 20px; white-space: nowrap; cursor: pointer; font-size: 0.9rem; color: #555; }
        .filter-btn.active { background: var(--primary); color: white; }
        .rule-card { background: var(--card-bg); padding: 18px; border-radius: 12px; border-left: 5px solid #ccc; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 15px; }
        .rule-card.important { border-left-color: var(--accent); }
        .rule-card h2 { margin-top: 0; font-size: 1.1rem; display: flex; justify-content: space-between; align-items: center; color: var(--primary); }
        .rule-card .category-tag { font-size: 0.65rem; background: #eee; padding: 3px 8px; border-radius: 4px; color: #666; font-weight: normal; text-transform: uppercase; }
        .rule-card p { line-height: 1.5; color: #444; margin: 10px 0; }
        .rule-card .source { font-size: 0.75rem; color: #999; font-style: italic; display: block; text-align: right; }
        .counter-card { background: white; border-radius: 15px; padding: 25px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .pitch-display { font-size: 5rem; font-weight: bold; color: var(--text); line-height: 1; margin: 10px 0; transition: color 0.3s; }
        .pitch-label { color: #888; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; }
        .rest-status { margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 10px; border: 1px solid #eee; }
        .rest-days { font-size: 1.5rem; font-weight: bold; color: var(--primary); display: block; margin-bottom: 5px; }
        .next-threshold { font-size: 0.9rem; color: #666; }
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .ctrl-btn { border: none; padding: 20px; border-radius: 12px; font-size: 1.5rem; cursor: pointer; touch-action: manipulation; }
        .btn-minus { background: #e0e0e0; color: #333; }
        .btn-plus { background: var(--primary); color: white; font-weight: bold; box-shadow: 0 4px 0 #00332a; }
        .btn-plus:active { transform: translateY(4px); box-shadow: none; }
        .reset-btn { margin-top: 20px; background: transparent; border: 1px solid #ccc; color: #888; padding: 10px 20px; border-radius: 20px; font-size: 0.9rem; cursor: pointer; }
        .gc-link-card { background: var(--card-bg); padding: 25px; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 25px; }
        .gc-logo { color: var(--gc-blue); font-weight: 900; font-size: 1.5rem; margin-bottom: 10px; display: block; }
        .gc-button { background: var(--gc-blue); color: white; text-decoration: none; padding: 15px 30px; border-radius: 30px; font-weight: bold; display: inline-block; box-shadow: 0 4px 6px rgba(0,134,209,0.3); transition: transform 0.2s; }
        .gc-button:active { transform: scale(0.98); }
        .game-list { list-style: none; padding: 0; margin: 0; }
        .game-item { background: white; border-bottom: 1px solid #eee; padding: 15px; display: flex; align-items: center; justify-content: space-between; }
        .game-item:last-child { border-bottom: none; }
        .game-date { font-weight: bold; color: var(--primary); font-size: 0.9rem; width: 60px; text-align: center; line-height: 1.2; }
        .game-info { flex: 1; padding-left: 15px; }
        .game-opponent { font-weight: 600; font-size: 1.1rem; margin-bottom: 2px; }
        .game-meta { font-size: 0.85rem; color: #666; }
        .schedule-container { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .status-0 { color: var(--safe); }
        .status-1 { color: var(--warning); }
        .status-2 { color: #f57f17; }
        .status-3 { color: #e65100; }
        .status-4 { color: var(--accent); }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>Bronco Manager</h1>
        <p>Escondido Youth Baseball</p>
    </div>

    <div class="nav-tabs">
        <button class="tab-btn active" onclick="switchTab('rules')">ðŸ“– Rules</button>
        <button class="tab-btn" onclick="switchTab('counter')">âš¾ Pitching</button>
        <button class="tab-btn" onclick="switchTab('schedule')">ðŸ“… Schedule</button>
    </div>

    <div id="view-rules" class="view-section active">
        <div class="dashboard">
            <div class="stat-card alert">
                <h3>Max Pitches</h3>
                <div class="value">85</div>
            </div>
            <div class="stat-card">
                <h3>Max Time</h3>
                <div class="value">1:50</div>
            </div>
            <div class="stat-card">
                <h3>Mercy Rule</h3>
                <div class="value">10 run / 5 inn</div>
            </div>
            <div class="stat-card">
                <h3>Min Play</h3>
                <div class="value">Sit 1 / All 1</div>
            </div>
        </div>

        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Search rules (e.g. 'subs', 'mound')...">
        </div>

        <div class="filters" id="filterContainer">
            <button class="filter-btn active" onclick="filterRules('All')">All</button>
            <button class="filter-btn" onclick="filterRules('Pitching')">Pitching</button>
            <button class="filter-btn" onclick="filterRules('Game Time')">Time/Mercy</button>
            <button class="filter-btn" onclick="filterRules('Roster & Batting')">Roster</button>
            <button class="filter-btn" onclick="filterRules('Base Running')">Running</button>
            <button class="filter-btn" onclick="filterRules('Field Prep')">Field Prep</button>
        </div>

        <div id="rulesContainer"></div>
    </div>

    <div id="view-counter" class="view-section">
        <div class="counter-card">
            <div class="pitch-label">Current Pitch Count</div>
            <div class="pitch-display status-0" id="countDisplay">0</div>
            
            <div class="rest-status">
                <span class="rest-days" id="restDisplay">0 Days Rest</span>
                <span class="next-threshold" id="thresholdDisplay">20 pitches until 1 Day Rest</span>
            </div>

            <div class="controls">
                <button class="ctrl-btn btn-minus" onclick="updatePitch(-1)">âˆ’</button>
                <button class="ctrl-btn btn-plus" onclick="updatePitch(1)">+ Pitch</button>
            </div>

            <button class="reset-btn" onclick="if(confirm('Reset counter to 0?')) { updatePitch(-999); }">Reset Counter</button>
        </div>
        
        <div style="margin-top: 20px; font-size: 0.85rem; color: #666; padding: 0 10px;">
            <strong>Bronco (11-12) Rest Rules:</strong><br>
            â€¢ 1-20: 0 Days<br>
            â€¢ 21-35: 1 Day<br>
            â€¢ 36-50: 2 Days<br>
            â€¢ 51-65: 3 Days<br>
            â€¢ 66+: 4 Days<br>
            â€¢ <strong>MAX: 85</strong>
        </div>
    </div>

    <div id="view-schedule" class="view-section">
        <div class="gc-link-card">
            <span class="gc-logo">GameChanger</span>
            <p>View full roster, stats, and live stream.</p>
            <a href="https://web.gc.com/teams/oygknL58ynlG?utm_source=Web&utm_campaign=team_share_link" target="_blank" class="gc-button">
                Open Team Schedule
            </a>
        </div>

        <h3 style="margin-left: 10px; color: #555;">Upcoming Games (Manual)</h3>
        <div class="schedule-container">
            <ul class="game-list" id="manualGamesList">
                </ul>
        </div>
        <p style="text-align: center; color: #999; font-size: 0.8rem; margin-top: 15px;">
            Edit <code>data.js</code> to update this list.
        </p>
    </div>
</div>

<script src="data.js"></script>

<script>
    // --- APP LOGIC ---

    // 1. INIT: Render Rules & Games (Using data from data.js)
    const rulesContainer = document.getElementById('rulesContainer');
    const searchInput = document.getElementById('searchInput');
    const manualGamesList = document.getElementById('manualGamesList');
    let currentCategory = 'All';

    // Verify data.js loaded
    if (typeof broncoRules === 'undefined') {
        alert("Error: data.js not loaded. Check file path.");
    } else {
        renderRules(broncoRules);
        renderGames(manualGames);
    }

    function renderRules(rules) {
        rulesContainer.innerHTML = rules.map(rule => `
            <div class="rule-card ${rule.important ? 'important' : ''}">
                <h2>${rule.title} <span class="category-tag">${rule.category}</span></h2>
                <p>${rule.content}</p>
                <div class="source">Source: ${rule.source}</div>
            </div>
        `).join('');
    }

    function renderGames(games) {
        manualGamesList.innerHTML = games.map(game => `
            <li class="game-item">
                <div class="game-date">${game.date}</div>
                <div class="game-info">
                    <div class="game-opponent">${game.opponent}</div>
                    <div class="game-meta">${game.info}</div>
                </div>
            </li>
        `).join('');
    }

    // 2. SEARCH & FILTER
    function filterRules(category) {
        currentCategory = category;
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.toggle('active', btn.innerText === category || (category === 'Time/Mercy' && btn.innerText === 'Time/Mercy'));
        });
        applyFilters();
    }

    function applyFilters() {
        const query = searchInput.value.toLowerCase();
        const filtered = broncoRules.filter(rule => {
            const matchesCategory = currentCategory === 'All' || rule.category === currentCategory;
            const matchesSearch = rule.title.toLowerCase().includes(query) || 
                                  rule.content.toLowerCase().includes(query) ||
                                  rule.category.toLowerCase().includes(query);
            return matchesCategory && matchesSearch;
        });
        renderRules(filtered);
    }
    searchInput.addEventListener('input', applyFilters);

    // 3. TAB LOGIC
    function switchTab(tabId) {
        document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById('view-' + tabId).classList.add('active');
        
        const tabMap = { 'rules': 0, 'counter': 1, 'schedule': 2 };
        document.querySelectorAll('.tab-btn')[tabMap[tabId]].classList.add('active');
    }

    // 4. PITCH COUNTER LOGIC
    let pitchCount = 0;
    
    function updatePitch(change) {
        if (change === -999) pitchCount = 0;
        else pitchCount += change;
        if (pitchCount < 0) pitchCount = 0;
        
        const countDisplay = document.getElementById('countDisplay');
        const restDisplay = document.getElementById('restDisplay');
        const thresholdDisplay = document.getElementById('thresholdDisplay');
        
        countDisplay.innerText = pitchCount;

        // Use thresholds from data.js
        let currentStatus = pitchThresholds[0];
        let nextThreshold = pitchThresholds[0].limit;
        let colorClass = "status-0";

        // Simple logic for standard thresholds
        if (pitchCount > 65) { currentStatus = pitchThresholds[4]; nextThreshold = 85; colorClass = "status-4"; }
        else if (pitchCount > 50) { currentStatus = pitchThresholds[3]; nextThreshold = 65; colorClass = "status-3"; }
        else if (pitchCount > 35) { currentStatus = pitchThresholds[2]; nextThreshold = 50; colorClass = "status-2"; }
        else if (pitchCount > 20) { currentStatus = pitchThresholds[1]; nextThreshold = 35; colorClass = "status-1"; }

        if (pitchCount >= 85) {
            restDisplay.innerText = "MAX LIMIT REACHED";
            thresholdDisplay.innerText = "Finish current batter only.";
            colorClass = "status-4";
        } else {
            restDisplay.innerText = currentStatus.rest + " Rest Required";
            const pitchesLeft = nextThreshold - pitchCount;
            thresholdDisplay.innerText = `${pitchesLeft} pitches until ${currentStatus.next} Rest`;
        }
        countDisplay.className = `pitch-display ${colorClass}`;
    }
    updatePitch(0); // Init
</script>
</body>
</html>
